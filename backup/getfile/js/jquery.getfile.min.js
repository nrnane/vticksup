/*
 *	GetFile v4.2.4 - 2015-09-01
 *	jQuery Upload Plugin
 *	(c) 2015 Syscover S.L. - http://www.syscover.com/
 *	All rights reserved
 */
"use strict";!function(e){var i={options:{urlPlugin:".",folder:null,tmpFolder:null,srcFolder:null,srcFile:null,encryption:!1,filename:null,outputExtension:null,quality:100,multiple:!1,maxFileSize:!1,maxFilesSizes:!1,activateTmpDelete:!0,spinner:!0,mimesAccept:["image/*","video/*","audio/*","text/plain","application/pdf","application/msword","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],crop:{active:!1,width:null,height:null,quality:100,overwrite:!1,aspectRatio:null,setData:null},resize:{active:!1,width:null,height:null,quality:75,constrainProportions:!0},copies:[{width:null,height:null,quality:75,constrainProportions:!0,prefix:null,folder:null,outputExtension:null}],lang:{cropWindowTitle:"Crop image",previewTitle:"Preview",cropButtonText:"Crop",cancelButtonText:"Cancel"},selectorItems:{container:"#cropper-modal",cropButton:"#gfCropButton",cancelButton:"#gfCancelButton",crop:".img-container",image:".img-original",preview:".img-preview"}},items:{container:null,cropButton:null,cancelButton:null,crop:null,image:null,preview:null},properties:{files:null,coords:null,tmpDelete:345600,tmpName:"",oldName:null,extension:null,mime:null,size:null,isImage:null,width:null,height:null,pixelRatio:null,src:null,response:null},callback:null,init:function(i,t,o){var s=this;void 0==i.copies?this.options.copies=[]:e.each(i.copies,function(t,o){i.copies[t]=e.extend({},s.options.copies[0],o||{})}),void 0!=i.crop&&(i.crop=e.extend({},this.options.crop,i.crop||{})),this.options=e.extend({},this.options,i||{});var p=this.options.lang;if(p.urlPlugin=i.urlPlugin,e.ajax({cache:!1,dataType:"html",type:"POST",url:this.options.urlPlugin+"/getfile/views/popup.php",data:p,success:function(i){s.options.crop.active&&0==e(s.options.selectorItems.container).length&&e("body").append(i),s.items={container:e(s.options.selectorItems.container),cropButton:e(s.options.selectorItems.cropButton),cancelButton:e(s.options.selectorItems.cancelButton),crop:e(s.options.selectorItems.crop),image:e(s.options.selectorItems.image),preview:e(s.options.selectorItems.preview)},s.items.cancelButton.on("click",function(){e("#cropper-modal").modal("hide")}),null!=s.options.srcFolder&&s.loadSrc()},error:function(e){var e={success:!1,error:12,message:"The path: "+s.url+" in the ajax request is not correct, please check the ajax function data"};t(e)}}),i.mimesAccept&&(this.options.mimesAccept=i.mimesAccept),this.callback=t,null==this.options.srcFolder){if(this.elem=e(o),this.options.multiple)var n={multiple:!0,logging:!1};else var n={logging:!1};if(0==this.options.mimesAccept||"[object Array]"===Object.prototype.toString.call(this.options.mimesAccept))window.fd.logging=!1,fd.jQuery(),e(this.elem).filedrop(n).filedrop().event("send",function(e){s.upload(e)});else{var r={success:!1,error:11,message:"The mimesAccept setting must be an array or false. Setting it to false might be dangerous, since it means accepting all file types"};null!=this.callback&&this.callback(r)}}return this},upload:function(i){var t=this;this.options.spinner&&e.cssLoader.show({urlPlugin:this.options.urlPlugin+"/getfile/libs",useLayer:!1,theme:"carousel"});var o=new FormData;if(this.options.multiple){var s=0;if(i.each(function(e){s+=e.size}),null!=this.options.maxFilesSizes&&0!=this.options.maxFilesSizes&&s>this.options.maxFilesSizes){this.options.spinner&&e.cssLoader.hide();var p=s/1048576,n=this.options.maxFilesSizes/1048576,r={success:!1,error:16,message:"The files whith weighing "+p.toFixed(2)+" Mb they does not been uploaded to the server, to exceed the maximum files sizes allowed of "+n.toFixed(2)+" Mb"};return this.callback(r),!1}var l=0,r=[];if(i.each(function(e){if(null!=t.options.maxFileSize&&0!=t.options.maxFileSize&&e.size>t.options.maxFileSize){var i=e.size/1048576,s=t.options.maxFileSize/1048576;r.push({success:!1,error:15,message:"The file "+e.name+" weighing "+i.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed of "+s.toFixed(2)+" Mb"})}else o.append("file"+l,e.nativeFile),l++}),!(l>0))return this.options.spinner&&e.cssLoader.hide(),r={success:!1,multiple:!0,files:r},this.callback(r),!1;r.length>0&&(this.properties.response=r),o.append("nFiles",l)}else{var a=i.first();if(null!=this.options.maxFileSize&&0!=this.options.maxFileSize&&a.size>this.options.maxFileSize||null!=this.options.maxFilesSizes&&0!=this.options.maxFilesSizes&&a.size>this.options.maxFilesSizes){this.options.spinner&&e.cssLoader.hide();var p=event.target.files[0].size/1048576,n=this.options.maxFileSize/1048576,r={success:!1,error:15,message:"The file "+event.target.files[0].name+" weighing "+p.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed of "+n.toFixed(2)+" Mb"};return this.callback(r),!1}o.append("file",a.nativeFile)}o.append("multiple",this.options.multiple),o.append("action","upload"),o.append("folder",this.options.folder),o.append("tmpFolder",this.options.tmpFolder),o.append("cropActive",this.options.crop.active),o.append("resizeActive",this.options.resize.active),o.append("outputExtension",this.options.outputExtension),o.append("encryption",this.options.encryption),o.append("filename",this.options.filename),o.append("mimesAccept",this.options.mimesAccept),o.append("activateTmpDelete",this.options.activateTmpDelete),o.append("tmpDelete",this.properties.tmpDelete),e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",data:o,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&null!=t.callback){var i=e.loaded/e.total*100|0,o={success:!0,action:"loading",total:e.total,loaded:e.loaded,percentage:i};t.callback(o)}},!1),e},error:function(o){if(t.options.spinner&&e.cssLoader.hide(),t.options.multiple){var s=[];e.each(i,function(e,i){var p=i.size/1048576,n={success:!1,error:13,message:"The file "+i.name+" weighing "+p.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed to server: "+t.phpIni.postMaxSize,exception:o};s.push(n)}),t.callback(s)}else{var p=i.first(),n=p.size/1048576,s={success:!1,error:13,message:"The file "+p.name+" weighing "+n.toFixed(2)+" Mb has not been uploaded to the server, to exceed the maximum file size allowed to server:"+t.phpIni.postMaxSize,exception:o};t.callback(s)}},success:function(i){if(t.options.multiple?t.properties.files=i.files:(t.properties.tmpName=i.name,t.properties.size=i.size,t.properties.oldName=i.oldName,t.properties.extension=i.extension,t.properties.mime=i.mime,t.properties.isImage=i.isImage),t.options.crop.active&&i.isImage&&0==t.options.multiple)t.properties.width=i.width,t.properties.height=i.height,t.properties.pixelRatio=window.devicePixelRatio,e("#cropper-modal").off("shown.bs.modal").on("shown.bs.modal",function(){t.crop(t.options.tmpFolder+"/"+i.name)}).off("hidden.bs.modal").on("hidden.bs.modal",function(){e(t.items.image).prop("src",""),e(t.items.image).cropper("destroy")}),t.items.cropButton.off("click").on("click",function(){t.executeCrop()}),e("#cropper-modal").modal("show");else if(t.options.resize.active&&i.isImage||t.options.resize.active&&1==t.options.multiple)if(t.options.multiple){var o=!1;e.each(t.properties.files,function(e,i){return 1==i.isImage?(o=!0,t.executeResize(),!1):void 0}),o||null==t.callback||t.callback(i)}else t.executeResize();else if(null!=t.options.outputExtension&&i.isImage||null!=t.options.outputExtension&&1==t.options.multiple)if(t.options.multiple){var o=!1;e.each(t.properties.files,function(e,i){return 1==i.isImage?(o=!0,t.executeChangeExtension(),!1):void 0}),o||null==t.callback||t.callback(i)}else t.executeChangeExtension();else if(t.options.copies.length>0&&i.isImage||t.options.copies.length>0&&1==t.options.multiple)if(t.options.multiple){var o=!1;e.each(t.properties.files,function(e,s){return 1==s.isImage?(o=!0,t.executeCopies(i),!1):void 0}),o||null==t.callback||t.callback(i)}else t.executeCopies(i);else null!=t.callback&&(t.options.multiple&&e.merge(i.files,r),t.callback(i));t.options.spinner&&e.cssLoader.hide()}})},loadSrc:function(){var i=this;this.options.tmpFolder=this.options.srcFolder,this.properties.src=this.options.tmpFolder+"/"+this.options.srcFile,e("#cropper-modal").off("shown.bs.modal").on("shown.bs.modal",function(){i.crop(i.properties.src)}).off("hidden.bs.modal").on("hidden.bs.modal",function(){e(i.items.image).prop("src",""),e(i.items.image).cropper("destroy")}),e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",data:{action:"getinfosrc",src:i.properties.src},type:"POST",dataType:"json",cache:!1,success:function(t){i.properties.tmpName=t.oldName,i.properties.size=t.size,i.properties.oldName=t.oldName,i.properties.extension=t.extension,i.properties.mime=t.mime,i.properties.isImage=t.isImage,i.properties.width=t.width,i.properties.height=t.height,i.properties.pixelRatio=window.devicePixelRatio,i.items.cropButton.off("click").on("click",function(){i.executeCrop()}),e("#cropper-modal").modal("show")}})},crop:function(i){var t=this;if(!e.fn.cropper){var o={success:!1,error:3,message:"Cropper library not loaded"};null!=this.callback&&this.callback(o)}if(this.options.crop.height&&this.options.crop.width)this.options.crop.aspectRatio=this.options.crop.width/this.options.crop.height;else if(isNaN(this.options.crop.aspectRatio)){var o={success:!1,error:4,message:"Width and Height or Ratio must be defined"};null!=this.callback&&this.callback(o)}e(this.items.image).prop("src",i),e(this.items.image).cropper({aspectRatio:this.options.crop.aspectRatio,preview:".img-preview",strict:!0,built:function(){null!=t.options.crop.setData&&e(this).cropper("setData",t.options.crop.setData)},crop:function(e){t.properties.coords={x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height),rotate:Math.round(e.rotate)}}});var s=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./);s&&(this.properties.tmpNameIE11=this.properties.tmpName,this.properties.sizeIE11=this.properties.size,this.properties.oldNameIE11=this.properties.oldName,this.properties.extensionIE11=this.properties.extension,this.properties.mimeIE11=this.properties.mime,this.properties.isImageIE11=this.properties.isImage)},executeCrop:function(){var i=this;e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:{action:"crop",tmpName:void 0==this.properties.tmpName?this.properties.tmpNameIE11:this.properties.tmpName,size:void 0==this.properties.size?this.properties.sizeIE11:this.properties.size,oldName:void 0==this.properties.oldName?this.properties.oldNameIE11:this.properties.oldName,extension:void 0==this.properties.extension?this.properties.extensionIE11:this.properties.extension,mime:void 0==this.properties.mime?this.properties.mimeIE11:this.properties.mime,isImage:void 0==this.properties.isImage?this.properties.isImageIE11:this.properties.isImage,coords:this.properties.coords,cropWidth:this.options.crop.width,cropHeight:this.options.crop.height,quality:this.options.crop.quality,overwrite:this.options.crop.overwrite,aspectRatio:this.options.crop.aspectRatio,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,copies:this.options.copies},success:function(t){e("#cropper-modal").modal("hide"),null!=i.callback&&i.callback(t)},error:function(e){null!=i.callback&&i.callback(e.responseJSON)}})},showCropWindow:function(i){var t=this;this.items.cropButton.off("click").on("click",function(){t.executeCrop()}),e("#cropper-modal").modal("show"),null!=i&&i({success:!0,action:"showCropWindow"})},executeResize:function(){var i=this;if(this.options.multiple)var t={action:"resize",multiple:!0,files:this.properties.files,tmpFolder:this.options.tmpFolder,folder:this.options.folder,quality:this.options.resize.quality,width:this.options.resize.width,height:this.options.resize.height,constrainProportions:this.options.resize.constrainProportions,outputExtension:this.options.outputExtension,copies:this.options.copies};else var t={action:"resize",multiple:!1,tmpName:this.properties.tmpName,size:this.properties.size,oldName:this.properties.oldName,extension:this.properties.extension,mime:this.properties.mime,isImage:this.properties.isImage,tmpFolder:this.options.tmpFolder,folder:this.options.folder,quality:this.options.resize.quality,width:this.options.resize.width,height:this.options.resize.height,constrainProportions:this.options.resize.constrainProportions,outputExtension:this.options.outputExtension,copies:this.options.copies};e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:t,success:function(t){null!=i.callback&&(i.options.multiple&&null!=i.properties.response&&e.merge(t.files,i.properties.response),i.callback(t))},error:function(e){null!=i.callback&&i.callback(e.responseJSON)}})},executeChangeExtension:function(){var i=this;if(this.options.multiple)var t={action:"change",multiple:!0,files:this.properties.files,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,quality:this.options.quality,copies:this.options.copies};else var t={action:"change",multiple:!1,tmpName:this.properties.tmpName,size:this.properties.size,oldName:this.properties.oldName,extension:this.properties.extension,mime:this.properties.mime,isImage:this.properties.isImage,tmpFolder:this.options.tmpFolder,folder:this.options.folder,outputExtension:this.options.outputExtension,quality:this.options.quality,copies:this.options.copies};e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:t,success:function(t){null!=i.callback&&(i.options.multiple&&null!=i.properties.response&&e.merge(t.files,i.properties.response),i.callback(t))},error:function(e){null!=i.callback&&i.callback(e.responseJSON)}})},executeCopies:function(i){var t=this;i.action="copies",i.folder=this.options.folder,i.copies=this.options.copies,this.options.multiple?(i.multiple=!0,i.files=this.properties.files):i.multiple=!1,e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:i,success:function(i){null!=t.callback&&(t.options.multiple&&null!=t.properties.response&&e.merge(i.files,t.properties.response),t.callback(i))},error:function(e){null!=t.callback&&t.callback(e.responseJSON)}})},"delete":function(i,t){e.ajax({url:this.options.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:{action:"delete",filenames:i},success:function(e){null!=t&&t(e)}})}};"function"!=typeof Object.create&&(Object.create=function(e){function i(){}return i.prototype=e,new i}),e.fn.getFile=function(t,o){return i.hasOwnProperty("phpIni")||e.ajax({url:t.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:{action:"getvars"},success:function(e){i.phpIni=e}}),this.data("getFile")?this.data("getFile"):this.data("getFile",Object.create(i).init(t,o,this))},e.getFile=function(t,o){i.hasOwnProperty("phpIni")||e.ajax({url:t.urlPlugin+"/getfile/php/Controllers/server.php",type:"POST",dataType:"json",cache:!1,data:{action:"getvars"},success:function(e){i.phpIni=e}}),e.data(document,"getFile",Object.create(i).init(t,o,null))}}(jQuery);